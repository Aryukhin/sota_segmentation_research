# Исследование моделей сегментации уровня SOTA

Данный репозиторий содержит материалы для исследования state-of-the-art (SOTA) моделей сегментации. В нем представлены финальные результаты, промежуточные исследования и скрипты для воспроизведения полного цикла работы моделей.

## Структура репозитория

- **Seg_sota_model_research.ipynb**  
  Финальный ноутбук с визуализацией результатов работы моделей сегментации. Здесь собраны итоговые метрики, графики и сравнения производительности моделей.

- **dirty_research_notebooks/**  
  Директория с промежуточными ноутбуками (`.ipynb`), использованными на этапах исследования, отладки, обучения и улучшения моделей. Здесь сохраняются черновики и фиксы, внесенные в процессе работы.

- **pc_scripts/**  
  Скрипты для демонстрации полного цикла работы модели:
  1. Получение изображения.
  2. Сегментация.
  3. Визуализация результатов.
  4. Сохранение полученных сегментированных изображений.

- **yolo_weights/**  
  Веса дообученной модели YOLO для сегментации дорожной разметки, оптимизированной для задач данного проекта.


## Описание проделанной работы  

### 1. **Датасет**  
- Использован датасет с размерами изображений 600x800 пикселей.  
- Маски сегментации были визуализированы, и каждый класс был представлен для анализа данных.  
## Загрузка датасета

Для скачивания датасета Lyft Segmentation выполните следующую команду:
```bash
!curl -L $(yadisk-direct https://disk.yandex.com/d/jJrOLbYlBYVESQ) -o lyft_segmentation.zip
```
### 2. **Модели и результаты**  

#### **SAM (Segment Anything Model)**  
- **Особенности**:  
  Модель автоматически сегментировала множество объектов на изображении.  
- **Проблемы**:  
  - Сгенерированное количество масок (до 80) затрудняло анализ.  
  - Высокие требования к памяти GPU делали дообучение невозможным.  
- **Решение**:  
  Использование промптов для выбора конкретных объектов.  
- **Результаты**:  
  - Средний IoU: 0.7803  
  - Средний F1 Score: 0.8654  
  - Наилучший результат у класса "Road" (IoU: 0.9259, F1 Score: 0.9615).  
  Однако результаты для мелких объектов, таких как "Car", оказались низкими (IoU: 0.5210).  

---

#### **YOLOv8**  
- **Особенности**:  
  YOLOv8 была выбрана за её лёгкость и возможность быстрого обучения.  
- **Подход**:  
  Созданы аннотации только для класса "Roadline" из-за ограничений ресурсов.  
- **Результаты**:  
  - После дообучения:  
    - IoU: 0.4933  
    - F1 Score: 0.6607  
    - Recall: 0.9148  
  Модель показала ограниченные возможности сегментации, что связано с нехваткой мощности вычислительных ресурсов.  

---

#### **OneFormer**  
- **Особенности**:  
  Предобученная версия модели на Cityscapes показала высокую точность для ряда классов:  
  - "Building" (IoU: 0.8984, F1 Score: 0.9465)  
  - "Road" (IoU: 0.9327, F1 Score: 0.9652)  
- **Проблемы**:  
  Из-за высоких требований к памяти GPU модель не смогла быть дообучена даже при минимальных размерах батча.  
- **Результаты**:  
  OneFormer подходит для использования предобученных весов, но невозможность дообучения ограничивает его применение.  

---

#### **SegFormer**  
- **Особенности**:  
  Протестированы версии модели (cityscapes b1, cityscapes b5, smallest SegFormer model (B0) pre-trained on ImageNet-1k). Версия b5, предобученная на Cityscapes, продемонстрировала лучшие результаты:  
  - "Road": IoU: 0.9707, F1 Score: 0.9851  
  - "Car": IoU: 0.9733, F1 Score: 0.9865  
  - "Sidewalk": IoU: 0.8448, F1 Score: 0.9159  
- **Решение проблем**:  
  SegFormer b5 сочетает высокую точность сегментации, возможность классификации всех классов и умеренные требования к ресурсам.  
- **Результаты**:  
  Модель продемонстрировала лучшие результаты после дообучения.  

**Веса модели SegFormer после fune-tunig можно скачать [по этой ссылке](https://drive.google.com/file/d/1M-CM2EZCgg8NL-uBPD1UC30m9tH7P_Ke/view?usp=sharing).**

---

## Общий вывод  
- **SAM**: слишком ресурсоёмкая для дообучения.  
- **YOLOv8**: быстрая, но ограничена в точности из-за особенностей аннотаций.  
- **OneFormer**: хорош для использования предобученных весов, но требует значительных ресурсов для обучения.  
- **SegFormer b5**: выбрана в качестве финальной модели, так как обеспечивает наилучшие результаты на всех классах и подходит для дообучения в условиях ограниченных ресурсов.  

---

## Контакты  
Если у вас есть вопросы или предложения, свяжитесь со мной через Issues или Pull Requests на этом репозитории.
